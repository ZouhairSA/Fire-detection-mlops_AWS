<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üî• D√©tection d'Incendie ‚Äî Mini ChatGPT</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <main class="container">
    <header class="hero">
      <h1>üî• D√©tection d‚ÄôIncendie ‚Äî IA (YOLO)</h1>
      <p>T√©l√©versez une image pour analyser la pr√©sence de feu</p>
    </header>

    <section class="uploader">
      <form id="uploadForm" method="POST" enctype="multipart/form-data">
        <div class="file-row">
          <!-- Input file cach√© + label cliquable -->
          <input id="fileInput" name="image" type="file" accept="image/*" hidden>
          <button type="button" id="pickBtn" class="btn">Cliquez ici pour choisir une image</button>

          <!-- Bouton pour lancer l'analyse -->
          <button type="submit" id="analyzeBtn" class="btn primary" disabled>Analyser</button>
        </div>

        <!-- Preview -->
        <div id="previewWrap" class="preview hidden">
          <img id="previewImg" src="" alt="Preview" />
          <p id="previewName"></p>
        </div>

        <!-- Message de statut renvoy√© par Flask (render_template passes `results` et `image_path`) -->
        <div id="resultWrap" class="result">
          {% if results %}
            {% if results|length == 0 %}
              <div class="no-fire">‚úÖ Aucun feu d√©tect√©.</div>
            {% else %}
              <div class="found">
                <h3>‚ö†Ô∏è Feu d√©tect√©</h3>
                <ul>
                {% for d in results %}
                  <li>{{ d.class }} ‚Äî confiance : {{ d.confidence }}</li>
                {% endfor %}
                </ul>
                {% if image_path %}
                  <div class="out-image">
                    <p>Image analys√©e :</p>
                    <img src="{{ url_for('static', filename='input.jpg') }}" alt="Analysed image" />
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% elif results is not none and results=={'error':'No image uploaded'} %}
            <div class="error">‚ö†Ô∏è Aucun fichier s√©lectionn√©. Choisissez une image d'abord.</div>
          {% endif %}
        </div>
      </form>
    </section>

    <footer class="foot">
      <small>Projet MLOps ‚Äî Fire Detection ‚Ä¢ Zouhair & Ibtihal</small>
    </footer>
  </main>

<script>
  // JS minimal pour d√©clencher l'input, preview et activer le bouton Analyser
  const pickBtn = document.getElementById('pickBtn');
  const fileInput = document.getElementById('fileInput');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const previewWrap = document.getElementById('previewWrap');
  const previewImg = document.getElementById('previewImg');
  const previewName = document.getElementById('previewName');

  pickBtn.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (!file) {
      previewWrap.classList.add('hidden');
      analyzeBtn.disabled = true;
      return;
    }
    // Affiche preview
    const reader = new FileReader();
    reader.onload = (e) => {
      previewImg.src = e.target.result;
      previewName.textContent = file.name;
      previewWrap.classList.remove('hidden');
      analyzeBtn.disabled = false;
    };
    reader.readAsDataURL(file);
  });

  // Si utilisateur clique sur Analyser sans fichier ‚Äî on prot√®ge
  document.getElementById('uploadForm').addEventListener('submit', (e) => {
    if (!fileInput.files || fileInput.files.length === 0) {
      e.preventDefault();
      alert("Choisissez d'abord une image avant d'analyser.");
    } else {
      // laisse le form se soumettre en POST vers Flask
      analyzeBtn.disabled = true;
      analyzeBtn.textContent = "Analyse en cours...";
    }
  });
</script>
</body>
</html>


<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fire Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4 text-center">üî• Fire Detection üî•</h1>

    <form method="POST" enctype="multipart/form-data" class="mb-4">
        <div class="mb-3">
            <input type="file" class="form-control" name="image" required>
        </div>
        <button type="submit" class="btn btn-danger w-100">Upload & Predict</button>
    </form>

    {% if image_path %}
    <div class="text-center mb-4">
        <h4>Image Uploaded:</h4>
        <img src="{{ image_path }}" alt="Uploaded Image" class="img-fluid rounded" style="max-height:400px;">
    </div>
    {% endif %}

    {% if results %}
    <div class="card p-3">
        <h4>Predictions:</h4>
        <ul class="list-group list-group-flush">
            {% for r in results %}
            <li class="list-group-item">
                <strong>{{ r.class }}</strong> ‚Äî Confidence: {{ r.confidence }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
</body>
</html> -->
